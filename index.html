<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Voting Guru Favorit - PKBM MELATI</title>

<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

<style>
  body {
    font-family: Arial, sans-serif;
    background: linear-gradient(135deg, #667eea, #764ba2);
    padding: 20px;
    margin: 0;
    color: #fff;
  }
  .container {
    max-width: 600px;
    margin: auto;
    background: white;
    color: #333;
    padding: 20px;
    border-radius: 12px;
  }
  .logo-wrap { text-align: center; margin-bottom: 10px; }
  .logo {
    width: 90px;
    height: 90px;
    border-radius: 50%;
    object-fit: cover;
    border: 3px solid #667eea;
  }
  h1 { text-align: center; color:#667eea; font-size:22px; }
  h2 { text-align:center; margin-top:-5px; color:#764ba2; }

  .candidate {
    background: #667eea;
    color: white;
    padding: 14px;
    margin: 10px 0;
    border-radius: 10px;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  button {
    padding: 8px 16px;
    border: none;
    background: white;
    color: #667eea;
    border-radius: 8px;
    font-weight: bold;
    cursor: pointer;
  }
  button:disabled {
    background: #ccc;
    color: #555;
    cursor: not-allowed;
  }
  #doneMessage {
    text-align: center;
    margin-top: 15px;
    font-size: 18px;
    color: green;
    display: none;
  }
</style>
</head>
<body>

<div class="container">

  <div class="logo-wrap">
    <img src="https://files.catbox.moe/l0f8t2.jpg" class="logo">
  </div>

  <h1>ðŸŽ“ VOTING GURU TERFAVORIT ðŸŽ“</h1>
  <h2>PKBM MELATI</h2>

  <div id="list"></div>
  <div id="doneMessage">Terima kasih, suara Anda telah terekam âœ…</div>

</div>

<script>
/* === FIREBASE CONFIG === */
const firebaseConfig = {
  apiKey: "AIzaSyBW8G3BOTmZxCc7IkjgK40XNvSqNxJqma0",
  authDomain: "pkbm-melatii.firebaseapp.com",
  projectId: "pkbm-melatii",
  storageBucket: "pkbm-melatii.firebasestorage.app",
  messagingSenderId: "877041628308",
  appId: "1:877041628308:web:c80972df07c0504e007081",
  databaseURL: "https://pkbm-melatii-default-rtdb.firebaseio.com"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

/* === DATA KANDIDAT === */
const candidates = [
  "Bobi Hartanto, S.Pd",
  "Suprayetno, S.Pd",
  "Dra. Suzana",
  "Dra. Maznah",
  "Dra. Fajarida, Ld",
  "Innani Sumartini, S.Pd"
];

const listDiv = document.getElementById("list");
let voted = localStorage.getItem("alreadyVoted");

/* === RENDER LIST === */
function render(votes) {
  listDiv.innerHTML = "";
  candidates.forEach((name, i) => {
    const count = votes[name] || 0;
    const box = document.createElement("div");
    box.className = "candidate";
    box.innerHTML = `
      <span>${i+1}. ${name}</span>
      <span><b>${count}</b> suara</span>
      <button ${voted ? "disabled" : ""} onclick="vote('${name}')">Vote</button>
    `;
    listDiv.appendChild(box);
  });

  if (voted) document.getElementById("doneMessage").style.display = "block";
}

/* === REALTIME DATABASE === */
db.ref("votes").on("value", snap => {
  render(snap.val() || {});
});

/* === TELEGRAM === */
const botToken = "8075129453:AAHb75QqznKgmLTtDgThmP6pJveTphSRmKo";
const chatId = "8116752882";

function sendToTelegram(name) {
  const message = `ðŸ“© Suara Masuk!\nâœ… Pilihan: ${name}\nðŸ« PKBM MELATI\nðŸ•’ ${new Date().toLocaleTimeString()}`;
  fetch(`https://api.telegram.org/bot${botToken}/sendMessage`, {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({ chat_id: chatId, text: message })
  });
}

/* === PROSES VOTE === */
function vote(name) {
  if (voted) return;

  const refVote = db.ref("votes/" + name);
  refVote.once("value").then(snapshot => {
    const current = snapshot.val() || 0;
    refVote.set(current + 1);
  });

  sendToTelegram(name);
  localStorage.setItem("alreadyVoted", "1");
  voted = true;
  document.getElementById("doneMessage").style.display = "block";
}
</script>

</body>
</html>
