<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Voting Guru Favorit</title>
<style>
  body { font-family: Arial, sans-serif; background: #f2f2f2; padding: 20px; }
  h1 { text-align: center; }
  .candidate { background: white; padding: 12px; margin: 10px 0; border-radius: 8px; display: flex; justify-content: space-between; align-items: center; }
  button { padding: 8px 14px; border: none; background: #007bff; color: white; border-radius: 6px; cursor: pointer; }
  button:disabled { background: gray; cursor: not-allowed; }
  .count { font-weight: bold; }
  #doneMessage { text-align: center; margin-top: 20px; font-size: 18px; color: green; display: none; }
</style>
</head>
<body>

<h1>Voting Guru Favorit</h1>
<div id="list"></div>
<div id="doneMessage">Terima kasih, suara Anda telah terekam âœ…</div>

<script type="module">
/* ==========================
   FIREBASE SETUP
========================== */
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getDatabase, ref, onValue, update } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

// firebaseConfig kamu (SUDAH ADA)
const firebaseConfig = {
  apiKey: "AIzaSyBW8G3BOTmZxCc7IkjgK40XNvSqNxJqma0",
  authDomain: "pkbm-melatii.firebaseapp.com",
  projectId: "pkbm-melatii",
  storageBucket: "pkbm-melatii.firebasestorage.app",
  messagingSenderId: "877041628308",
  appId: "1:877041628308:web:c80972df07c0504e007081",
  measurementId: "G-LFH125W36H",
  databaseURL: "https://pkbm-melatii-default-rtdb.firebaseio.com"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

/* ==========================
   DATA KANDIDAT
========================== */
const candidates = [
  "Bobi Hartanto, S.Pd",
  "Suprayetno, S.Pd",
  "Dra. Suzana",
  "Dra. Maznah",
  "Dra. Fajarida, Ld",
  "Innani Sumartini, S.Pd"
];

/* ==========================
   RENDER UI
========================== */
const listDiv = document.getElementById("list");
let voted = localStorage.getItem("alreadyVoted");

function render(votes) {
  listDiv.innerHTML = "";
  candidates.forEach((name, i) => {
    const count = votes[name] || 0;
    const box = document.createElement("div");
    box.className = "candidate";
    box.innerHTML = `
      <span>${i+1}. ${name}</span>
      <span class="count">${count} suara</span>
      <button ${voted ? "disabled" : ""} onclick="vote('${name}')">Vote</button>
    `;
    listDiv.appendChild(box);
  });
  if (voted) document.getElementById("doneMessage").style.display = "block";
}

/* ==========================
   REALTIME UPDATE
========================== */
onValue(ref(db, "votes"), snapshot => {
  render(snapshot.val() || {});
});

/* ==========================
   KIRIM KE TELEGRAM
========================== */
const chatId = "8116752882"; 

async function sendToTelegram(name) {

  const token = "8075129453:AAHb75QqznKgmLTtDgThmP6pJveTphSRmKo"; // ðŸ”¥ kamu tempel sendiri

  const message = `ðŸ“© Suara Masuk!\nâœ… Pilihan: ${name}\nðŸ•’ Waktu: ${new Date().toLocaleTimeString()}`;

  await fetch(`https://api.telegram.org/bot${token}/sendMessage`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ chat_id: chatId, text: message })
  });
}

/* ==========================
   PROSES VOTE
========================== */
window.vote = async function(name) {
  if (voted) return;

  const voteRef = ref(db, "votes/" + name);
  onValue(voteRef, async snapshot => {
    const current = snapshot.val() || 0;
    await update(ref(db, "votes"), { [name]: current + 1 });
  }, { onlyOnce: true });

  sendToTelegram(name);
  localStorage.setItem("alreadyVoted", "1");
  voted = true;
  render({});
};
</script>

</body>
</html>
